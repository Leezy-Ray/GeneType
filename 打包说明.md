# 基因型分析 - 打包为 exe 说明

## 环境要求（打包时）

- Windows 10 或 11
- Python 3.8+（已安装并加入 PATH）
- 已安装项目依赖：`pip install -r requirements.txt`，以及 `pip install parasail`

**建议**：若当前环境安装了大量科学计算库（如 pandas、torch、tensorflow），打包会较慢且 exe 较大。可新建虚拟环境只装必要依赖再打包：
```bat
python -m venv venv_build
venv_build\Scripts\activate
pip install -r requirements.txt parasail pyinstaller
pyinstaller --noconfirm GeneType.spec
```

## 打包步骤

1. 打开命令提示符或 PowerShell，进入项目目录：
   ```bat
   cd D:\workplace\GeneType
   ```

2. 双击运行 **`build_exe.bat`**，或在命令行执行：
   ```bat
   build_exe.bat
   ```
   脚本会自动安装 PyInstaller（若未安装）、检查依赖并打包。

3. 打包完成后，可执行文件位于：
   ```
   dist\GeneType.exe
   ```

**说明**：spec 中已通过 `collect_all('parasail')` 打包 **parasail.dll**。若未打包该 DLL，exe 内 parasail 无法加载，会走 Biopython 等回退比对，结果会与直接运行 `python genotype_gui.py` 不一致。打包后建议用同一批数据对比 exe 与 Python 结果是否一致。

## 使用打包后的 exe

- **无需安装 Python**，将 `GeneType.exe` 复制到任意 Windows 10/11 电脑即可运行。
- 建议将 `GeneType.exe` 与 `known_polymorphisms.txt` 放在同一目录（若需使用已知多态性过滤）；exe 内已包含该文件，运行时优先使用 exe 内嵌版本。
- 参考序列（.dna）和测序文件（.ab1）由用户在界面中选择，无路径限制。
- 首次运行若杀毒软件提示，请选择“允许”或“信任”（PyInstaller 打包的程序可能被误报）。

**重新打包前**：请先关闭正在运行的 `GeneType.exe`，否则会报「拒绝访问」无法覆盖 dist 下的 exe。

## 打包时报错「文件包含病毒或潜在的垃圾软件」(WinError 225)

PyInstaller 生成的 exe 常被 Windows Defender 误报。若打包在「Copying icon to EXE」阶段报错，请先**排除项目目录**再打包：

1. 打开 **Windows 安全中心** → **病毒和威胁防护** → **管理设置** → **排除项** → **添加或删除排除项**
2. **添加排除项** → **文件夹** → 选择项目目录（如 `D:\workplace\GeneType`）
3. 重新执行打包：在项目目录下打开 **PowerShell** 或 **命令提示符**，执行：
   ```bat
   pyinstaller --noconfirm GeneType.spec
   ```
4. 打包完成后，exe 在 `dist\GeneType.exe`。分发到其他电脑时，若对方杀毒软件提示，选择「允许」或「信任」即可。

## 手动打包（可选）

若需自定义打包参数，可手动执行：

```bat
pip install pyinstaller
pyinstaller --noconfirm GeneType.spec
```

或不用 spec 文件：

```bat
pyinstaller --onefile --windowed --name GeneType ^
  --add-data "known_polymorphisms.txt;." ^
  genotype_gui.py
```

（Windows 下 `--add-data` 使用分号 `;` 分隔路径与目标目录。）
